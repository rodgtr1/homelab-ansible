services:
  pihole:
    image: {{ pihole_image }}
    container_name: pihole
    restart: unless-stopped

    # Use host networking for DNS (port 53)
    network_mode: host

    environment:
      - TZ={{ timezone }}
      - FTLCONF_webserver_api_password={{ pihole_web_password }}
      - FTLCONF_webserver_domain={{ pihole_domain }}
      - FTLCONF_LOCAL_IPV4={{ pihole_ip }}
      - PIHOLE_DNS_={{ pihole_dns1 }};{{ pihole_dns2 }}

    volumes:
      - {{ pihole_dir }}/etc-pihole:/etc/pihole
      - {{ pihole_dir }}/etc-dnsmasq.d:/etc/dnsmasq.d

    cap_add:
      - NET_ADMIN

  unbound:
    image: {{ unbound_image }}
    container_name: unbound
    restart: unless-stopped

    # Share Pi-hole's network stack
    network_mode: service:pihole

    volumes:
      - {{ pihole_dir }}/unbound/unbound.conf:/etc/unbound/unbound.conf:ro
